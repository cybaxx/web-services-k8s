# kube-prometheus-stack Helm values (dev)
# Configures Prometheus, Grafana, and Alertmanager for the wetfish k3d cluster

# Prometheus configuration
prometheus:
  prometheusSpec:
    # Storage
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi
          storageClassName: local-path

    # Dev-friendly resource limits
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

    # Retention
    retention: 7d
    retentionSize: "8GB"

    # Discover ServiceMonitors across all namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    serviceMonitorNamespaceSelector: {}
    podMonitorNamespaceSelector: {}

    # External URL for Prometheus
    externalUrl: "http://prometheus.wetfish.local:8080"

  # Ingress for Prometheus UI
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - prometheus.wetfish.local
    paths:
      - /
    pathType: Prefix

# Alertmanager configuration
alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 2Gi
          storageClassName: local-path

    resources:
      requests:
        memory: "128Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"

  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - alertmanager.wetfish.local
    paths:
      - /
    pathType: Prefix

# Grafana configuration
grafana:
  enabled: true
  adminPassword: admin

  persistence:
    enabled: true
    size: 2Gi
    storageClassName: local-path

  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "300m"

  # Pre-configured data sources
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki.wetfish-monitoring.svc.cluster.local:3100
      access: proxy
    - name: Tempo
      type: tempo
      url: http://tempo.wetfish-monitoring.svc.cluster.local:3100
      access: proxy

  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - grafana.wetfish.local
    path: /
    pathType: Prefix

# Node Exporter
nodeExporter:
  enabled: true

# Kube State Metrics
kubeStateMetrics:
  enabled: true

# Prometheus Operator
prometheusOperator:
  enabled: true
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"
