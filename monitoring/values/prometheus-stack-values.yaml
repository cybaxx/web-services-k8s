# kube-prometheus-stack Helm values
# This configures Prometheus, Grafana, and Alertmanager for the wetfish cluster

# Global settings
nameOverride: ""
fullnameOverride: ""

# Prometheus configuration
prometheus:
  prometheusSpec:
    # Storage configuration
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi
          storageClassName: local-path

    # Resource limits
    resources:
      requests:
        memory: "2Gi"
        cpu: "500m"
      limits:
        memory: "4Gi"
        cpu: "2000m"

    # Retention period
    retention: 30d
    retentionSize: "45GB"

    # Enable service monitor discovery
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false

    # External URL for Prometheus
    externalUrl: "http://prometheus.wetfish.local"

  # Ingress for Prometheus UI
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - prometheus.wetfish.local
    paths:
      - /
    pathType: Prefix

# Alertmanager configuration
alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi
          storageClassName: local-path

    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"

  # Ingress for Alertmanager UI
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - alertmanager.wetfish.local
    paths:
      - /
    pathType: Prefix

# Grafana configuration
grafana:
  enabled: true

  # Admin credentials (change in production!)
  adminPassword: admin

  # Persistence
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: local-path

  # Resource limits
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Data sources
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus-kube-prometheus-prometheus:9090
        access: proxy
        isDefault: true
      - name: Loki
        type: loki
        url: http://loki:3100
        access: proxy
      - name: Tempo
        type: tempo
        url: http://tempo:3100
        access: proxy

  # Ingress for Grafana
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - grafana.wetfish.local
    path: /
    pathType: Prefix

# Node Exporter
nodeExporter:
  enabled: true

# Kube State Metrics
kubeStateMetrics:
  enabled: true

# Prometheus Operator
prometheusOperator:
  enabled: true
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"
